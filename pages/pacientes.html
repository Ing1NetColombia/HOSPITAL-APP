<!-- Modal -->
<div
  class="modal fade"
  id="modalAgregar"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          Agregar paciente
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form id="formPaciente">
          <div class="form-group">
            <label for="documento">Documento:</label>
            <input type="number" name="documento" id="" class="form-control" />
          </div>
          <div class="form-group">
            <label for="nombre">Nombre:</label>
            <input type="text" name="nombre" id="" class="form-control" />
          </div>
          <div class="form-group">
            <label for="edad">Edad:</label>
            <input type="number" name="edad" id="" class="form-control" />
          </div>
          <div class="form-group">
            <label for="sexo">Sexo:</label>
            <select name="sexo" class="form-control" id="">
              <option value="" disabled selected>Seleccione una opci√≥n</option>
              <option value="F">Femenino</option>
              <option value="M">Masculino</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button
          type="button"
          onclick="guardarPaciente()"
          class="btn btn-primary"
        >
          Aceptar
        </button>
      </div>
    </div>
  </div>
</div>
<!-- fin modal -->
<div class="row">
  <div class="col-6 offset-3">
    <button class="btn btn-success" onclick="agregar()">Agregar</button>
    <table id="tabla">
      <thead>
        <th>id</th>
        <th>documento</th>
        <th>nombre</th>
        <th>edad</th>
        <th>sexo</th>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
  $(document).ready(function () {
    var datosTabla = JSON.parse(localStorage.getItem("pacientes")) || [];
    console.log(datosTabla);
    $("#tabla").DataTable({
      responsive: true,
      data: datosTabla,
      columnDefs: [
        {
          defaultContent: "-",
          targets: "_all",
        },
      ],
      columns: [
        { data: "id" },
        { data: "documento" },
        { data: "nombre" },
        { data: "edad" },
        { data: "sexo" },
      ],
    });
  });

  function agregar() {
    $("#modalAgregar").modal("show");
    $("#formPaciente")[0].reset();
  }

  function guardarPaciente() {
    let formulario = document.getElementById("formPaciente");

    let datos = new FormData(formulario);
    var objetoJson = {};

    // Iterate over each field in the form
    for (var item of datos.entries()) {
      objetoJson[item[0]] = item[1]; // Add the field name and value to the JSON object
    }

    let pacientes = JSON.parse(localStorage.getItem("pacientes")) || [];
    console.log(pacientes);
    objetoJson["id"] = pacientes.length + 1;
    console.log(objetoJson);
    pacientes.push(objetoJson);
    console.log(pacientes);
    localStorage.setItem("pacientes", JSON.stringify(pacientes));
  }
</script>
